<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Build a City</title>
  <style>
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
  </style>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div id="tooltip" style="display: none;"></div>
  <div id="message" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,0,0,0.8); color: white; padding: 10px 20px; border-radius: 5px; z-index: 2000;"></div>

  <!-- Character Selection Screen -->
  <div id="character-selection" class="character-selection-screen">
    <h1>Choose Your Character</h1>
    <p class="selection-subtitle">Select a character and color to begin your city building journey</p>
    
    <!-- Color Selection -->
    <div class="color-selection-section" style="margin: 30px 0;">
      <h2 style="color: white; margin-bottom: 15px;">Choose Your Color</h2>
      <div class="color-options" style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; max-width: 600px; margin: 0 auto;">
        <div class="color-option" data-color="red" style="width: 60px; height: 60px; border-radius: 50%; background: #FF0000; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('red')" title="Red"></div>
        <div class="color-option" data-color="darkblue" style="width: 60px; height: 60px; border-radius: 50%; background: #00008B; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('darkblue')" title="Dark Blue"></div>
        <div class="color-option" data-color="cyan" style="width: 60px; height: 60px; border-radius: 50%; background: #00FFFF; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('cyan')" title="Cyan"></div>
        <div class="color-option" data-color="yellow" style="width: 60px; height: 60px; border-radius: 50%; background: #FFFF00; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('yellow')" title="Yellow"></div>
        <div class="color-option" data-color="purple" style="width: 60px; height: 60px; border-radius: 50%; background: #800080; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('purple')" title="Purple"></div>
        <div class="color-option" data-color="green" style="width: 60px; height: 60px; border-radius: 50%; background: #008000; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('green')" title="Green"></div>
        <div class="color-option" data-color="orange" style="width: 60px; height: 60px; border-radius: 50%; background: #FFA500; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('orange')" title="Orange"></div>
        <div class="color-option" data-color="pink" style="width: 60px; height: 60px; border-radius: 50%; background: #FFC0CB; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" onclick="selectColor('pink')" title="Pink"></div>
      </div>
      <p id="selected-color-text" style="color: white; margin-top: 15px; font-size: 14px; opacity: 0.7;">No color selected</p>
    </div>
    
    <!-- Player Name Input -->
    <div class="name-selection-section" style="margin: 30px 0;">
      <h2 style="color: white; margin-bottom: 15px;">Enter Your Name</h2>
      <input type="text" id="player-name-input" placeholder="Enter your name..." maxlength="20" style="padding: 10px 15px; font-size: 16px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; width: 300px; max-width: 90%; text-align: center;" oninput="updatePlayerNamePreview()">
      <p id="name-preview-text" style="color: white; margin-top: 10px; font-size: 14px; opacity: 0.7;">Name will appear next to your character icon</p>
    </div>
    
    <div class="character-cards">
      <div class="character-card" data-character="miner">
        <div class="character-icon"><img src="images/pickaxe.png" alt="Miner" style="width: 80px; height: 80px;"></div>
        <h2>Miner</h2>
        <div class="character-benefits">
          <h3>Special Abilities:</h3>
          <ul>
            <li>20% discount on stone buildings</li>
            <li>50% bonus to stone production</li>
            <li>Access to unique mining buildings</li>
            <li>Deep Mine &amp; Ore Refinery</li>
          </ul>
        </div>
        <button class="select-character-btn" onclick="selectCharacter('miner')">Select Miner</button>
      </div>
      <div class="character-card" data-character="farmer">
        <div class="character-icon" style="font-size: 80px; line-height: 1;">üåæ</div>
        <h2>Farmer</h2>
        <div class="character-benefits">
          <h3>Special Abilities:</h3>
          <ul>
            <li>20% discount on farm buildings</li>
            <li>50% bonus to farming production</li>
            <li>30% faster population growth</li>
            <li>Access to unique farming buildings</li>
            <li>Advanced Farm &amp; Orchard</li>
          </ul>
        </div>
        <button class="select-character-btn" onclick="selectCharacter('farmer')">Select Farmer</button>
      </div>
    </div>
  </div>

  <!-- Main Game UI (hidden initially) -->
  <div id="main-game" style="display: none;">
  <h1>Build a City</h1>

  <!-- Settings Button (Upper Left) -->
  <button id="settings-btn" class="settings-btn" onclick="toggleSettings()" style="position: fixed; top: 10px; left: 10px; z-index: 1000; padding: 10px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
    ‚öôÔ∏è Settings
  </button>

  <!-- Player Indicator (Upper Right) -->
  <div id="player-indicator" class="player-indicator" style="position: fixed; top: 10px; right: 10px; z-index: 1000; display: none; align-items: center; gap: 10px; padding: 8px 15px; background: rgba(0,0,0,0.6); border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
    <div class="player-color-dot" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.5);"></div>
    <span class="player-character-text" style="color: white; font-weight: bold; font-size: 14px;"></span>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="shop-modal" style="display: none;">
    <div class="shop-content" style="max-width: 500px;">
      <div class="shop-header">
        <h2>Settings</h2>
        <button class="shop-close" onclick="toggleSettings()">&times;</button>
      </div>
      <div class="shop-body">
        <div class="tile-info-controls" style="display: flex; flex-direction: column; gap: 10px;">
          <button id="edit-mode-btn" class="edit-mode-btn" onclick="toggleEditMode()">
            <img src="images/edit.png" alt="Edit" class="edit-icon">
            <span class="edit-text">Edit Mode</span>
          </button>
          <button class="icon-btn" onclick="saveGame()">
            <img src="images/save.png" alt="Save" class="btn-icon">
            <span class="btn-text">Save Game</span>
          </button>
          <button class="icon-btn" onclick="showLoadMenu()">
            <img src="images/load.png" alt="Load" class="btn-icon">
            <span class="btn-text">Load Game</span>
          </button>
          <button class="icon-btn" onclick="exportSave()">
            <img src="images/export.png" alt="Export" class="btn-icon">
            <span class="btn-text">Export Save</span>
          </button>
          <button class="icon-btn" onclick="document.getElementById('import-file').click()">
            <img src="images/import.png" alt="Import" class="btn-icon">
            <span class="btn-text">Import Save</span>
          </button>
          <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importSave(event)">
          <button class="icon-btn" onclick="resetGame()">
            <img src="images/reset.png" alt="Reset" class="btn-icon">
            <span class="btn-text">Reset Game</span>
          </button>
          <p id="saveStatus" class="save-status"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Top HUD -->
  <div id="hud" class="hud">
    <div id="character-indicator" class="character-indicator" style="text-align: center; margin-bottom: 10px; font-size: 18px; color: #FFD700; display: none;"></div>
    <div style="text-align: center; margin-bottom: 10px; display: flex; gap: 10px; justify-content: center;">
      <button id="shop-btn" class="shop-btn" onclick="toggleShop()">
        <img src="images/store.png" alt="Shop" style="width: 40px; height: 40px;">
      </button>
      <button id="quests-btn" class="quests-btn" onclick="toggleQuests()">
        <img src="images/quests.png" alt="Quests" style="width: 40px; height: 40px;">
      </button>
    </div>
    <div class="resource-display">
      <span class="resource-item">
        <img src="images/wood-log.png" alt="Wood" data-resource="wood" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="wood" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/rock.png" alt="Stone" data-resource="stone" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="stone" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/clay.png" alt="Clay" data-resource="clay" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="clay" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/iron.png" alt="Iron" data-resource="iron" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="iron" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/gold.png" alt="Gold" data-resource="gold" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="gold" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/claybricks.png" alt="Bricks" data-resource="bricks" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="bricks" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/ironBar.webp" alt="Iron Bars" data-resource="ironBars" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="ironBars" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/coal.png" alt="Coal" data-resource="coal" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="coal" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
      <span class="resource-item">
        <img src="images/population.png" alt="Population" data-tooltip="Population" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="population" style="font-size: 24px; font-weight: bold;">0</span> / 
        <img src="images/cabin.png" alt="Capacity" data-tooltip="Housing Capacity" style="width: 40px; height: 40px; vertical-align: middle; margin: 0 5px; cursor: help;"> 
        <span id="housingCapacity" style="font-size: 24px; font-weight: bold;">0</span>
      </span>
    </div>
  </div>

  <div class="main-container">
    <!-- Left Panel: Build Menu -->
    <div id="build-menu" class="build-menu">
      <h3>Build Menu</h3>
      <div class="building-category">
        <h4>Housing</h4>
        <button class="building-btn" data-building-type="tepee"><br>Tepee</button>
        <button class="building-btn" data-building-type="cabin" disabled><br>Cabin</button>
        <button class="building-btn" data-building-type="brickHouse" disabled><br>Brick House</button>
      </div>
      <div class="building-category">
        <h4>Farming</h4>
        <button class="building-btn" data-building-type="farm"><br>Farm</button>
        <button class="building-btn" data-building-type="advancedFarm" disabled><br>Advanced Farm</button>
        <button class="building-btn" data-building-type="orchard" disabled><br>Orchard</button>
      </div>
      <div class="building-category">
        <h4>Wood Production</h4>
        <button class="building-btn" data-building-type="lumberMill"><br>Lumber Mill</button>
        <button class="building-btn" data-building-type="advancedLumberMill" disabled><br>Advanced Lumber Mill</button>
      </div>
      <div class="building-category">
        <h4>Minerals</h4>
        <button class="building-btn" data-building-type="quarry"><br>Quarry</button>
        <button class="building-btn" data-building-type="clayPool"><br>Clay Pool</button>
        <button class="building-btn" data-building-type="ironMine"><br>Iron Mine</button>
        <button class="building-btn" data-building-type="coalMine"><img src="images/coal.png" alt="Coal Mine" class="building-icon"><br>Coal Mine</button>
        <button class="building-btn" data-building-type="deepMine" disabled>Deep Mine</button>
        <button class="building-btn" data-building-type="oreRefinery" disabled><br>Ore Refinery</button>
      </div>
      <div class="building-category">
        <h4>Production</h4>
        <button class="building-btn" data-building-type="smelter"><br>Smelter</button>
      </div>
      <div class="building-category">
        <h4>Special</h4>
        <button class="building-btn" data-building-type="baseMarker"><br>Base Marker</button>
      </div>
    </div>

    <!-- Center: Grid -->
    <div class="grid-wrapper">
      <div id="grid-container" class="grid-container"></div>
    </div>

    <!-- Right Panel: Tile Info -->
    <div id="tile-info" class="tile-info">
      <h3>Building Info</h3>
      <p>Select a building to place or click on a placed building to view details.</p>
      
    </div>
  </div>
    
    <!-- Load Game Modal -->
    <div id="load-modal" class="load-modal" style="display: none;">
      <div class="load-content">
        <div class="load-header">
          <h2>Load Game</h2>
          <button class="load-close" onclick="hideLoadMenu()">&times;</button>
        </div>
        <div class="load-body">
          <div class="save-slots">
            <div class="save-slot-row">
              <div class="save-slot" data-slot="1">
                <h3>Save Slot 1</h3>
                <p class="slot-info" id="slot-1-info">Empty</p>
              </div>
              <div class="slot-buttons">
                <button class="slot-save-btn" onclick="saveGameSlot(1)">Save</button>
                <button class="slot-load-btn" onclick="loadGameSlot(1)">Load</button>
                <button class="slot-delete-btn" data-slot="1" onclick="deleteGameSlot(1)">Delete</button>
              </div>
            </div>
            <div class="save-slot-row">
              <div class="save-slot" data-slot="2">
                <h3>Save Slot 2</h3>
                <p class="slot-info" id="slot-2-info">Empty</p>
              </div>
              <div class="slot-buttons">
                <button class="slot-save-btn" onclick="saveGameSlot(2)">Save</button>
                <button class="slot-load-btn" onclick="loadGameSlot(2)">Load</button>
                <button class="slot-delete-btn" data-slot="2" onclick="deleteGameSlot(2)">Delete</button>
              </div>
            </div>
            <div class="save-slot-row">
              <div class="save-slot" data-slot="3">
                <h3>Save Slot 3</h3>
                <p class="slot-info" id="slot-3-info">Empty</p>
              </div>
              <div class="slot-buttons">
                <button class="slot-save-btn" onclick="saveGameSlot(3)">Save</button>
                <button class="slot-load-btn" onclick="loadGameSlot(3)">Load</button>
                <button class="slot-delete-btn" data-slot="3" onclick="deleteGameSlot(3)">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div> <!-- End main-game -->

  <!-- Shop Modal -->
  <div id="shop-modal" class="shop-modal" style="display: none;">
    <div class="shop-content">
      <div class="shop-header">
        <h2>Shop</h2>
        <button class="shop-close" onclick="toggleShop()">&times;</button>
      </div>
      <div class="shop-body">
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Sell Clay Bricks</h3>
            <span style="display: inline-flex; align-items: center; gap: 5px; margin-left: 5px;"><span style="display: inline-flex; align-items: center; gap: 3px;"><span style="font-weight: bold;">5</span> <img src="images/claybricks.png" alt="Bricks" style="width: 20px; height: 20px; vertical-align: middle;"></span> <span>:</span> <span style="display: inline-flex; align-items: center; gap: 3px;"><span style="font-weight: bold;">1</span> <img src="images/gold.png" alt="Gold" style="width: 20px; height: 20px; vertical-align: middle;"></span></span>
            <div style="margin: 15px 0;">
              <label for="brick-slider" style="display: block; margin-bottom: 10px; color: #fff;">
                Amount: <span id="brick-amount">0</span> bricks
              </label>
              <div class="brick-slider-wrapper">
                <div class="brick-slider-fill" id="brick-slider-fill"></div>
                <input type="range" id="brick-slider" min="0" max="100" step="5" value="0" 
                       oninput="updateBrickTrade(this.value)">
              </div>
            </div>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/claybricks.png" alt="Bricks" style="width: 30px; height: 30px; vertical-align: middle;">
                <span id="brick-cost-display">0</span>
              </span>
              <span style="margin: 0 10px;">‚Üí</span>
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span id="gold-reward-display">0</span>
              </span>
            </div>
          </div>
          <button id="sell-bricks-btn" class="shop-buy-btn" onclick="sellBricksForGold()">Sell</button>
        </div>
        
        <h3 style="margin-top: 20px; margin-bottom: 10px; color: #FFD700;">Upgrades</h3>
        
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Wood Production Boost</h3>
            <p>+20% wood production across all buildings</p>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span>100</span>
              </span>
            </div>
          </div>
          <button id="upgrade-wood-btn" class="shop-buy-btn" onclick="purchaseUpgrade('woodProduction', 100)">Purchase</button>
        </div>
        
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Stone Production Boost</h3>
            <p>+20% stone production across all buildings</p>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span>100</span>
              </span>
            </div>
          </div>
          <button id="upgrade-stone-btn" class="shop-buy-btn" onclick="purchaseUpgrade('stoneProduction', 100)">Purchase</button>
        </div>
        
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Clay Production Boost</h3>
            <p>+20% clay production across all buildings</p>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span>100</span>
              </span>
            </div>
          </div>
          <button id="upgrade-clay-btn" class="shop-buy-btn" onclick="purchaseUpgrade('clayProduction', 100)">Purchase</button>
        </div>
        
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Housing Capacity Boost</h3>
            <p>+20% housing capacity across all buildings</p>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span>100</span>
              </span>
            </div>
          </div>
          <button id="upgrade-housing-btn" class="shop-buy-btn" onclick="purchaseUpgrade('housingCapacity', 100)">Purchase</button>
        </div>
        
        <div class="shop-item">
          <div class="shop-item-info">
            <h3>Smelting Speed Boost</h3>
            <p>+20% clay brick smelting speed</p>
            <div class="shop-item-cost">
              <span class="shop-cost-item">
                <img src="images/gold.png" alt="Gold" style="width: 30px; height: 30px; vertical-align: middle;">
                <span>100</span>
              </span>
            </div>
          </div>
          <button id="upgrade-smelting-btn" class="shop-buy-btn" onclick="purchaseUpgrade('smeltingSpeed', 100)">Purchase</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quests Modal -->
  <div id="quests-modal" class="quests-modal" style="display: none;">
    <div class="quests-content">
      <div class="quests-header">
        <h2>Quests</h2>
        <button class="quests-close" onclick="toggleQuests()">&times;</button>
      </div>
      <div class="quests-tabs">
        <button class="quest-tab active" data-tab="incomplete" onclick="switchQuestTab('incomplete')">Incomplete</button>
        <button class="quest-tab" data-tab="completed" onclick="switchQuestTab('completed')">Completed</button>
      </div>
      <div class="quests-body">
        <!-- Quest content will go here -->
      </div>
    </div>
  </div>

  <!-- Quest Completion Popup -->
  <div id="quest-completion-popup" class="quest-completion-popup" style="display: none;">
    <div class="quest-completion-content">
      <div class="quest-completion-header">
        <h2>üéâ Quest Completed! üéâ</h2>
      </div>
      <div class="quest-completion-body">
        <h3 id="quest-completion-title"></h3>
        <p id="quest-completion-description"></p>
        <div class="quest-completion-reward">
          <strong>Reward:</strong> <span id="quest-completion-reward-text"></span>
        </div>
        <button class="quest-completion-close" onclick="closeQuestCompletionPopup()">Claim Reward</button>
      </div>
    </div>
  </div>

  <!-- Town Center Modal -->
  <div id="town-center-modal" class="shop-modal" style="display: none;">
    <div class="shop-content">
      <div class="shop-header">
        <h2 id="town-center-title">Town Center</h2>
        <button class="shop-close" onclick="closeTownCenterModal()">&times;</button>
      </div>
      <div class="shop-body">
        <div id="town-center-info" style="margin-bottom: 20px;">
          <h3 id="town-level-display">Level 1</h3>
          <p id="town-cap-contribution">Building Cap Contribution: +5</p>
        </div>
        
        <div id="town-quest-section" style="margin-bottom: 20px;">
          <h3 style="color: #FFD700; margin-bottom: 10px;">üìã Current Quest</h3>
          <div id="town-quest-content" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,215,0,0.3);">
            <!-- Quest content will be populated dynamically -->
          </div>
        </div>
        
        <div id="town-merchants-section" style="margin-bottom: 20px;">
          <h3 style="color: #FFD700; margin-bottom: 10px;">Available Merchants</h3>
          <div id="town-merchants-content">
            <p style="color: #aaa;">No merchants available yet. Complete quests to unlock merchants.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="script.js"></script>
</body>
</html>
